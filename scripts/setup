#!/usr/bin/env bash
export UV_LINK_MODE=copy

set -e

cd "$(dirname "$0")/.."

echo "ğŸ¼ [setup] Starting setup in $(pwd)"

# Download UV if not present
if ! command -v uv >/dev/null 2>&1; then
    echo "ğŸ” [setup] 'uv' not found. Installing UV..."
    curl -LsSf https://astral.sh/uv/install.sh | sh
    echo "âœ… [setup] UV installed."
else
    echo "âœ… [setup] 'uv' is already installed."
fi

# Create venv if not present
if [[ ! -d "${PWD}/.venv" ]]; then
    echo "ğŸ”§ [setup] Creating Python virtual environment (.venv)..."
    uv venv
    echo "âœ… [setup] Virtual environment created."
else
    echo "âœ… [setup] Virtual environment already exists."
fi

# Enable venv
echo "ğŸ”Œ [setup] Activating virtual environment..."
source "${PWD}/.venv/bin/activate"
echo "âœ… [setup] Virtual environment activated."

# Install dependencies
echo "ğŸ“¦ [setup] Installing dependencies with uv..."
uv sync --dev --frozen
echo "âœ… [setup] Dependencies installed."

echo "ğŸ‰ [setup] Setup complete."
